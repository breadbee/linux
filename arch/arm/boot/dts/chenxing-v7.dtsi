// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (c) 2019 thingy.jp.
 * Author: Daniel Palmer <daniel@thingy.jp>
 */

#include <dt-bindings/interrupt-controller/irq.h>
#include <dt-bindings/interrupt-controller/arm-gic.h>

/ {
	#address-cells = <1>;
	#size-cells = <1>;
	interrupt-parent = <&gic>;

	cpus {
		#address-cells = <1>;
		#size-cells = <0>;

		cpu0: cpu@0 {
			device_type = "cpu";
			compatible = "arm,cortex-a7";
			reg = <0x0>;
			clocks = <&cpuclk>;
			clock-names = "cpuclk";
		};
	};

	arch_timer {
		compatible = "arm,armv7-timer";
		interrupts = <GIC_PPI 13 (GIC_CPU_MASK_SIMPLE(2)
				| IRQ_TYPE_LEVEL_LOW)>,
			     <GIC_PPI 14 (GIC_CPU_MASK_SIMPLE(2)
				| IRQ_TYPE_LEVEL_LOW)>,
			     <GIC_PPI 11 (GIC_CPU_MASK_SIMPLE(2)
				| IRQ_TYPE_LEVEL_LOW)>,
			     <GIC_PPI 10 (GIC_CPU_MASK_SIMPLE(2)
				| IRQ_TYPE_LEVEL_LOW)>;
		clock-frequency = <6000000>;
	};

	pmu {
		compatible = "arm,cortex-a7-pmu";
		interrupts = <GIC_SPI 10 IRQ_TYPE_LEVEL_HIGH>,
			     <GIC_SPI 16 IRQ_TYPE_LEVEL_HIGH>,
			     <GIC_SPI 22 IRQ_TYPE_LEVEL_HIGH>,
			     <GIC_SPI 28 IRQ_TYPE_LEVEL_HIGH>;
	};

	clocks: clocks {
		/*
		 * For the msc313e there is only a 24mhz clock input so everything else must come
		 * from this base clock unless there are some on-die oscillators that aren't mentioned
		 * anywhere.
		 */
		xtal24: xtal24 {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <24000000>;
		};

		xtal12: xtal12 {
			#clock-cells = <0>;
			compatible = "fixed-factor-clock";
			clocks = <&xtal24>;
			clock-div = <2>;
			clock-mult = <1>;
		};

		rtc_32k: rtc_32k {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <32768>;
		};

		rtc32k_div4: rtc32k_div4 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&rtc_32k>;
			clock-div = <4>;
			clock-mult = <1>;
		};

		xtal12_div2: xtal12_div2 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <2>;
			clock-mult = <1>;
		};

		xtal12_div4: xtal12_div4 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <4>;
			clock-mult = <1>;
		};

		xtal12_div8: xtal12_div8 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <8>;
			clock-mult = <1>;
		};

		xtal12_div12: xtal12_div12 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <12>;
			clock-mult = <1>;
		};

		xtal12_div16: xtal12_div16 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <16>;
			clock-mult = <1>;
		};

		xtal12_div40: xtal12_div40 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&xtal12>;
			clock-div = <40>;
			clock-mult = <1>;
		};

		clk_mpll_288_div2: clk_mpll_288_div2 {
			compatible = "fixed-factor-clock";
			#clock-cells = <0>;
			clocks = <&clkgen_pll 8>;
			clock-div = <2>;
			clock-mult = <1>;
		};
	};

	soc: soc {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		sleepintc: sleepintc@1f001c10 {
			compatible = "mstar,msc313e-sleep-intc";
			reg = <0x1f001c10 0x8>;
			interrupts-extended = <&intc_irq 2 IRQ_TYPE_LEVEL_HIGH>;
			interrupt-controller;
			#interrupt-cells = <2>;
		};

		pmsleep: syscon@0x1f001cb8 {
			/* msc313e notes */
			/* 0x1f001c00 - wake up source */
			/*
			 * 1f001c24 -- bit 11 disables pm uart rx
			 * -- bit 15 is set when going into deep sleep
			 *
			 * mysteryclk1 1f001cf4
			 * 0x1f001cc0 -- ??
			 * 0x1f001cc8  -- set to 9fe8 before deep sleep
			 * 0x1f001ccc  -- set to 9fe8 before deep sleep
			 * 0x1f001cdc  -- set to 0xa5 before deep sleep
			 * 0x1f001c70  -- set to 0x0c before deep sleep
			 * 0x1f001c48  -- set to 0xbabe before deep sleep
			 *
			 * 1f001cec -- return address after resume
			 * 1f001cf0
			 * 1f001cf4 -- clck for timers?
			 */
			/*
			 * 0x1f001cb8 - writing 0x79 triggers a cpu reset
			 * 0x1f001cbc - bit 3 in here controls something to do with the temp sensor
			 */
			compatible = "syscon";
			reg = <0x1f001cb8 0x8>;
		};

		reboot {
			compatible = "syscon-reboot";
			regmap = <&pmsleep>;
			offset = <0x0>;
			mask = <0x79>;
		};

		wdt: wdt@1f006000 {
			compatible = "mstar,msc313e-wdt";
			reg = <0x1f006000 0x1f>;
			clocks = <&xtal12>;
			interrupts-extended = <&intc_fiq 2 IRQ_TYPE_LEVEL_HIGH>;
		};

		gic: interrupt-controller@16001000 {
			compatible = "arm,cortex-a7-gic";
			#interrupt-cells = <3>;
			#address-cells = <1>;
			#size-cells = <1>;
			interrupt-controller;
			reg = <0x16001000 0x1000>,
			      <0x16002000 0x1000>;
		};

		intc_fiq: intc@1f201310 {
			compatible = "mstar,msc313e-intc-fiq";
			interrupt-controller;
			reg = <0x1f201310 0x40>;
			#interrupt-cells = <2>;
			interrupt-parent = <&gic>;
			gic-offset = <96>;
			nr-interrupts = <32>;
		};

		intc_irq: intc@1f201350 {
			compatible = "mstar,msc313e-intc-irq";
			interrupt-controller;
			reg = <0x1f201350 0x40>;
			#interrupt-cells = <2>;
			interrupt-parent = <&gic>;
			gic-offset = <32>;
			nr-interrupts = <64>;
		};

		cpuclk: cpuclk@1f206500 {
			compatible = "mstar,msc313e-cpuclk";
			reg = <0x1f206500 0x100>;
			#clock-cells = <0>;
			clocks = <&clkgen_pll 6>;
		};

		clkgen_mux_uart: clkgen_mux@1f2070c4 {
			compatible = "mstar,msc313e-clkgen-mux";
			reg = <0x1f2070c4 0x4>;
			#clock-cells = <1>;
			clock-output-names = "uart0", "uart1";
			shifts = <0>, <8>;
			mux-shifts = <2>, <10>;
			mux-widths = <2>, <2>;
			clocks = <&clkgen_pll 10>,
				 <&clk_mpll_288_div2>,
				 <&xtal12>;
		};

		/* this should be renamed to clk gates or something */
		clkgen_pll: clkgen_pll@1f2071c0 {
			compatible = "mstar,msc313e-clkgen-pll";
			reg = <0x1f2071c0 0x10>;
			#clock-cells = <1>;
			clock-output-names = "upll_384", "upll_320", "utmi_160", "utmi_192",
					     "utmi_240", "utmi_480", "mpll_432", "mpll_345",
					     "mpll_288", "mpll_216", "mpll_172", "mpll_144",
					     "mpll_123", "mpll_124", "mpll_86", "pll_rv1";
			clock-rates = <384000000>, <320000000>, <160000000>, <192000000>,
			              <240000000>, <480000000>, <432000000>, <345000000>,
			              <288000000>, <216000000>, <172000000>, <144000000>,
			              <123000000>, <124000000>, <86000000>, <0>;
			clock-upstreams = <1>, <1>, <0>, <0>,
					  <0>, <0>, <0>, <0>,
					  <0>, <0>, <0>, <0>,
					  <0>, <0>, <0>, <0>;
			clocks = <&xtal24>, <&upll0>; /*<&utmi>;*/
		};

		gpio: gpio@1f207800 {
			#gpio-cells = <2>;
			reg = <0x1f207800 0x200>;
			gpio-controller;
			status = "disabled";
		};
		
		pinctrl: pinctrl@1f203c00 {
			reg = <0x1f203c00 0x200>;
			pm_uart_pins: pm_uart {
				function = "pm_uart";
				groups = "pm_uart";
			};
			pm_spi_pins: pm_spi {
				function = "pm_spi";
				groups = "pm_spi";
			};
			emac_pins: eth {
				function = "eth";
				groups = "eth";
			};
			fuart_pins: fuart {
				function = "fuart";
				groups = "fuart";
			};
			fuart_rx_tx_rts_pins: fuart_rx_tx_rts {
				function = "fuart";
				groups = "fuart_rx_tx_rts";
			};
			uart1_pins: uart1 {
				function = "uart1";
				groups = "fuart_cts_rts";
			};
			uart1_cts_pins: uart1_cts {
				function = "uart1";
				groups = "fuart_cts";
			};
			i2c0_pins: i2c0 {
				function = "i2c0";
				groups = "i2c0";
			};
			i2c1_pins: i2c1 {
				function = "i2c1";
				groups = "i2c1";
			};
			spi0_spi0_pins: spi0_spi0 {
				function = "spi0";
				groups = "spi0";
			};
			spi0_fuart_pins: spi0_fuart {
				function = "spi0";
				groups = "fuart";
			};
			spi1_sd_d0_d1_d2_d3_pins: spi1_sd_d0_d1_d2_d3 {
				function = "spi1";
				groups = "sd_d0_d1_d2_d3";
			};
			sdio_pins: sdio {
				function = "sdio";
				groups = "sd";
				bias-pull-up;
			};
		};

		pm_uart: uart@1f221000 {
			compatible = "ns16550a";
			reg = <0x1f221000 0x100>;
			reg-shift = <3>;
			clocks = <&clkgen_mux_uart 0>;
			interrupts-extended = <&intc_irq 34 IRQ_TYPE_LEVEL_HIGH>;
			pinctrl-names = "default";
			pinctrl-0 = <&pm_uart_pins>;
			status = "disabled";
		};

		upll0: upll@1f284000 {
			#clock-cells = <0>;
			compatible = "mstar,msc313-upll";
			reg = <0x1f284000 0x20>;
			clocks = <&xtal12>;
		};

		sram: sram@a0000000 {
			compatible = "mmio-sram";
			reg = <0xa0000000 0x10000>;
		};
	};
};
